{% extends "layouts/base.html" %}

{% block title %} Open CLab {% endblock %}

{% block body_class %} sidebar-mini layout-navbar-fixed {% endblock body_class %}

{% block stylesheets %}
<!-- Google Font: Source Sans Pro -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<!-- Font Awesome -->
<link rel="stylesheet" href="/static/assets/plugins/fontawesome-free/css/all.min.css">
<!-- DataTables -->
<link rel="stylesheet" href="/static/assets/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="/static/assets/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
<!-- Theme style -->
<link rel="stylesheet" href="/static/assets/css/adminlte.min.css">
{% endblock stylesheets %}

{% block content %}

<div class="content-wrapper">

    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1>Open CLab</h1>
                    <small class="text-muted">View ContainerLab resources</small>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="{{ url_for('home_blueprint.index') }}">Home</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('clabs_blueprint.running') }}">ContainerLabs</a>
                        </li>
                        <li class="breadcrumb-item active">{{ lab.lab_instance_id }}</li>
                    </ol>
                </div>
            </div>
        </div>
    </section>

    <section class="content">

        <!-- Summary -->
        <div class="row">
            <div class="col-md-12">
                <div class="card card-outline card-primary">
                    <div class="card-header">
                        <h3 class="card-title">{{ lab.title }}</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-3">
                                <strong>Instance ID:</strong>
                                <p class="text-muted">{{ lab.lab_instance_id }}</p>
                            </div>
                            <div class="col-sm-3">
                                <strong>User:</strong>
                                <p class="text-muted">{{ lab.user }}</p>
                            </div>
                            <div class="col-sm-3">
                                <strong>Created (UTC):</strong>
                                <p class="text-muted">{{ lab.created or '--' }}</p>
                            </div>
                            <div class="col-sm-3">
                                <strong>Expires at:</strong>
                                <p class="text-muted">{{ lab.expires_at or '--' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Files Uploaded Section (Alteração para Bloco 3) -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card card-outline card-info">
                    <div class="card-header">
                        <h3 class="card-title">Uploaded Files</h3>
                    </div>
                    <div class="card-body">
                        {% if lab.files %}
                        <ul>
                            {% for file in lab.files %}
                            <li>
                                {{ file.filename if file.filename else file }} <!-- Exibe o nome do arquivo -->
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p>No files uploaded.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Resources table -->
        <div class="row">
            <div class="col-md-12">
                <div class="card card-outline card-secondary">
                    <div class="card-header">
                        <h3 class="card-title">Resources</h3>
                    </div>
                    <div class="card-body table-responsive">
                        <table id="tableResources" class="table table-striped display">
                            <thead>
                                <tr>
                                    <th>Kind</th>
                                    <th>Name</th>
                                    <th>Status</th>
                                    <th>Node</th>
                                    <th>Pod IP</th>
                                    <th>Age</th>
                                    <th>Services</th>
                                    <th>Links</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for r in lab.resources %}
                                <tr>
                                    <td>{{ r.kind }}</td>
                                    <td>{{ r.name }}</td>
                                    <td>
                                        {% if r.ready == 'Running' %}
                                        <span class="badge badge-success">{{ r.ready }}</span>
                                        {% else %}
                                        <span class="badge badge-secondary">{{ r.ready }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ r.node_name or '--' }}</td>
                                    <td>{{ r.pod_ip or '--' }}</td>
                                    <td>{{ r.age or '--' }}</td>
                                    <td>
                                        {% if r.services %}
                                        {% for s in r.services %}
                                        <a href="{{ s.url }}" class="btn btn-xs btn-outline-primary" target="_blank">{{
                                            s.name }}</a>
                                        {% endfor %}
                                        {% else %}
                                        <span class="text-muted">--</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if r.links %}
                                        {% for l in r.links %}
                                        <a href="{{ l.href }}" class="btn btn-xs btn-default">{{ l.label }}</a>
                                        {% endfor %}
                                        {% else %}
                                        <span class="text-muted">--</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </section>

</div>

{% endblock content %}

{% block javascripts %}
<!-- jQuery -->
<script src="/static/assets/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="/static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- DataTables -->
<script src="/static/assets/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/static/assets/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="/static/assets/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="/static/assets/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<!-- AdminLTE App -->
<script src="/static/assets/js/adminlte.min.js"></script>

<script>
    $(function () {
        $("#tableResources").DataTable({
            responsive: false,
            autoWidth: false,
            language: { emptyTable: 'No resources' },
            columns: [
                { name: 'kind' },
                { name: 'name' },
                { name: 'status' },
                { name: 'node' },
                { name: 'pod_ip' },
                { name: 'age' },
                { orderable: false, name: 'services' },
                { orderable: false, name: 'links' },
            ],
            order: [[1, 'asc']]
        });
    });
</script>
{% endblock javascripts %}